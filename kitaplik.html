<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>KNBÇ Kitaplığı</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg-color: #f9f9f9;
      --primary-color: #a3d5ff;
      --secondary-color: #ffd3e0;
      --accent-color: #d3ffd6;
      --text-color: #333;
      --card-bg: #ffffff;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: Arial, sans-serif; background: var(--bg-color); color: var(--text-color); }
    #welcome { display: flex; justify-content: center; align-items: center; height: 100vh; background: var(--primary-color); color: white; font-size: 2rem; text-align: center; }
    #main { display: none; padding-bottom: 2rem; }
    nav { background: var(--secondary-color); padding: 1rem; text-align: center; }
    nav h1 { margin-bottom: 0.5rem; }
    nav button { margin: 0 0.5rem; padding: 0.5rem 1rem; border: none; background: var(--primary-color); color: white; border-radius: 4px; cursor: pointer; }
    #stats { display: flex; gap: 1rem; justify-content: center; margin: 1rem 0; }
    #stats div { background: var(--accent-color); padding: 1rem; border-radius: 8px; width: 150px; text-align: center; }
    #importExport { text-align: center; margin: 1rem; }
    #importExport button { margin: 0.3rem; padding: 0.5rem 1rem; border: none; background: var(--secondary-color); color: var(--text-color); border-radius: 4px; cursor: pointer; }
    .modal-overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); z-index: 999; }
    .modal-overlay.active { display: block; }
    .modal { display: none; position: fixed; top:50%; left:50%; transform: translate(-50%, -50%); background: var(--bg-color); padding: 1rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); max-width: 500px; max-height: 90%; overflow: auto; z-index: 1000; }
    .modal.active { display: block; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; }
    .modal-header h2 { margin: 0; }
    .modal-close { background: transparent; border: none; font-size: 1.5rem; cursor: pointer; }
    form label { display: block; margin: 0.5rem 0 0.2rem; }
    form input, form textarea, form select { width: 100%; padding: 0.5rem; margin-bottom: 0.5rem; border: 1px solid #ccc; border-radius: 4px; }
    .controls { display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center; margin: 1rem; }
    .controls input, .controls select { padding: 0.5rem; }
    .controls button { padding: 0.5rem 1rem; border: none; background: var(--primary-color); color: white; border-radius: 4px; cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; }
    table th, table td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
    .card-list { display: flex; flex-wrap: wrap; gap: 1rem; margin: 1rem; }
    .card { background: var(--card-bg); border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); padding: 1rem; width: calc(33% - 2rem); position: relative; }
    .card img { max-width: 100%; border-radius: 4px; margin-bottom: 0.5rem; }
    .card h3 { margin-bottom: 0.5rem; }
    .card button { margin-top: 0.5rem; }
  </style>
</head>
<body>
  <div id="welcome">KNBÇ KİTAPLIĞINA<br>HOŞGELDİNİZ</div>
  <div id="main">
    <nav>
      <h1>KNBÇ KİTAPLIĞI</h1>
      <div>Ne yapmak istersiniz?
        <button onclick="openModal('addModal')">Kitap Ekle</button>
      </div>
    </nav>
    <section id="stats">
      <div>Toplam Kitap: <span id="totalBooks">0</span></div>
      <div>Okunan Kitap: <span id="readBooks">0</span></div>
    </section>
    <section id="importExport">
      <button onclick="exportData()">Dışa Aktar</button>
      <button onclick="importData()">İçe Aktar</button>
      <input type="file" id="fileInput" accept=".json" style="display:none" onchange="loadFile(event)">
    </section>
    <section id="list">
      <div class="controls">
        <input type="text" id="searchMain" placeholder="Ara..." oninput="renderList()" />
        <select id="filterReadMain" onchange="renderList()">
          <option value="all">Hepsi</option>
          <option value="read">Okunan</option>
          <option value="unread">Okunmayan</option>
        </select>
        <select id="filterAuthorMain" onchange="renderList()"><option value="">Yazar Filtrele</option></select>
        <select id="filterPublisherMain" onchange="renderList()"><option value="">Yayınevi Filtrele</option></select>
        <select id="filterTypeMain" onchange="renderList()"><option value="">Tür Filtrele</option></select>
        <select id="sortByMain" onchange="renderList()">
          <option value="added">Eklenme Tarihi</option>
          <option value="title">Kitap Adı</option>
          <option value="author">Yazar</option>
          <option value="publisher">Yayınevi</option>
          <option value="type">Tür</option>
        </select>
        <button onclick="toggleViewMain()">Görünüm</button>
      </div>
      <div id="tableViewMain">
        <table>
          <thead>
            <tr>
              <th>Kitap Adı</th>
              <th>Yazar</th>
              <th>Yayınevi</th>
              <th>Tür</th>
              <th>Yıl</th>
              <th>Okundu</th>
              <th>İşlemler</th>
            </tr>
          </thead>
          <tbody id="bookTableMain"></tbody>
        </table>
      </div>
      <div id="cardViewMain" class="card-list"></div>
    </section>
  </div>
  <div id="overlay" class="modal-overlay"></div>
  <div id="addModal" class="modal">
    <div class="modal-header">
      <h2>Kitap Ekle</h2><button class="modal-close" onclick="closeModal('addModal')">✕</button>
    </div>
    <form id="bookForm">
      <label>Kitap Adı</label><input type="text" id="title" required />
      <label>Yazar Adı</label><input type="text" id="author" />
      <label>Yayınevi</label><input type="text" id="publisher" />
      <label>Tür</label><input type="text" id="type" />
      <label>Yayın Yılı</label><input type="number" id="year" />
      <label>Kitap Özeti</label><textarea id="summary"></textarea>
      <label>Kapak URL</label><input type="url" id="cover" />
      <div style="text-align:center; margin-top:1rem;">
        <button type="submit">Kaydet</button>
      </div>
    </form>
  </div>
  <script>
    let books = [], editIndex = null, tableMode = true;
    window.onload = () => {
      const data = localStorage.getItem('books');
      if (data) books = JSON.parse(data);
      renderStats();
      populateFilters();
      renderList();
      setTimeout(() => {
        document.getElementById('welcome').style.display = 'none';
        document.getElementById('main').style.display = 'block';
      }, 3000);
    };
    function openModal(id) {
      document.getElementById('overlay').classList.add('active');
      document.getElementById(id).classList.add('active');
      document.getElementById('title').focus();
    }
    function closeModal(id) {
      document.getElementById('overlay').classList.remove('active');
      document.getElementById(id).classList.remove('active');
      document.getElementById('bookForm').reset();
      editIndex = null;
    }
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('title').addEventListener('blur', fetchFromAPI);
    });
    document.getElementById('bookForm').onsubmit = e => {
      e.preventDefault();
      const b = {
        title: title.value,
        author: author.value,
        publisher: publisher.value,
        type: type.value,
        year: year.value,
        summary: summary.value,
        cover: cover.value,
        added: new Date().toISOString(),
        read: false
      };
      if (editIndex !== null) books[editIndex] = b;
      else books.push(b);
      localStorage.setItem('books', JSON.stringify(books));
      document.getElementById('bookForm').reset();
      editIndex = null;
      renderStats();
      populateFilters();
      renderList();
      title.focus();
    };
    function fetchFromAPI() {
      if (!title.value) return;
      fetch(`https://www.googleapis.com/books/v1/volumes?q=intitle:${encodeURIComponent(title.value)}&langRestrict=tr`)
        .then(r => r.json()).then(d => {
          if (d.items && d.items.length) {
            const i = d.items[0].volumeInfo;
            author.value = i.authors ? i.authors.join(', ') : '';
            publisher.value = i.publisher || '';
            type.value = (i.categories && i.categories.length) ? i.categories[0] : '';
            year.value = i.publishedDate ? i.publishedDate.slice(0, 4) : '';
            summary.value = i.description || '';
            cover.value = i.imageLinks ? i.imageLinks.thumbnail : '';
          }
        }).catch(() => {});
    }
    function renderStats() {
      document.getElementById('totalBooks').innerText = books.length;
      document.getElementById('readBooks').innerText = books.filter(b => b.read).length;
    }
    function populateFilters() {
      const auths = [...new Set(books.map(b => b.author).filter(a => a))];
      const pubs  = [...new Set(books.map(b => b.publisher).filter(p => p))];
      const types = [...new Set(books.map(b => b.type).filter(t => t))];
      const fa = document.getElementById('filterAuthorMain');
      const fp = document.getElementById('filterPublisherMain');
      const ft = document.getElementById('filterTypeMain');
      fa.innerHTML = '<option value="">Yazar Filtrele</option>';
      fp.innerHTML = '<option value="">Yayınevi Filtrele</option>';
      ft.innerHTML = '<option value="">Tür Filtrele</option>';
      auths.forEach(a => fa.innerHTML += `<option value="${a}">${a}</option>`);
      pubs.forEach(p => fp.innerHTML += `<option value="${p}">${p}</option>`);
      types.forEach(t => ft.innerHTML += `<option value="${t}">${t}</option>`);
    }
    function renderList() {
      const tbody = document.getElementById('bookTableMain'),
            cardDiv = document.getElementById('cardViewMain');
      tbody.innerHTML = '';
      cardDiv.innerHTML = '';
      let list = [...books];
      const s   = document.getElementById('searchMain').value.toLowerCase();
      const fr  = document.getElementById('filterReadMain').value;
      const fa  = document.getElementById('filterAuthorMain').value;
      const fp  = document.getElementById('filterPublisherMain').value;
      const ft  = document.getElementById('filterTypeMain').value;
      const sort= document.getElementById('sortByMain').value;
      if (s)  list = list.filter(b => b.title.toLowerCase().includes(s));
      if (fr !== 'all') list = list.filter(b => fr === 'read' ? b.read : !b.read);
      if (fa) list = list.filter(b => b.author === fa);
      if (fp) list = list.filter(b => b.publisher === fp);
      if (ft) list = list.filter(b => b.type === ft);
      list.sort((a, b) => a[sort] > b[sort] ? 1 : -1);
      list.forEach((b, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${b.title}</td>
          <td>${b.author}</td>
          <td>${b.publisher}</td>
          <td>${b.type}</td>
          <td>${b.year}</td>
          <td><input type="checkbox" ${b.read ? 'checked' : ''} onchange="toggleRead(${i})"></td>
          <td>
            <button onclick="editBook(${i})">Düzenle</button>
            <button onclick="deleteBook(${i})">Sil</button>
          </td>`;
        tbody.appendChild(tr);
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          ${b.cover ? `<img src="${b.cover}">` : ''}
          <h3>${b.title}</h3>
          <p><strong>Yazar:</strong> ${b.author}</p>
          <p><strong>Yayınevi:</strong> ${b.publisher}</p>
          <p><strong>Tür:</strong> ${b.type}</p>
          <label><input type="checkbox" ${b.read ? 'checked' : ''} onchange="toggleRead(${i})"> Okundu</label>
          <button onclick="editBook(${i})">Düzenle</button>
          <button onclick="deleteBook(${i})">Sil</button>`;
        cardDiv.appendChild(card);
      });
    }
    function toggleViewMain() {
      tableMode = !tableMode;
      document.getElementById('tableViewMain').style.display = tableMode ? 'block' : 'none';
      document.getElementById('cardViewMain').style.display  = tableMode ? 'none' : 'flex';
    }
    function deleteBook(i) { if (confirm('Emin misiniz?')) { books.splice(i, 1); localStorage.setItem('books', JSON.stringify(books)); renderStats(); populateFilters(); renderList(); } }
    function editBook(i) { editIndex = i; openModal('addModal'); const b = books[i]; title.value = b.title; author.value = b.author; publisher.value = b.publisher; type.value = b.type; year.value = b.year; summary.value = b.summary; cover.value = b.cover; }
    function toggleRead(i) { books[i].read = !books[i].read; localStorage.setItem('books', JSON.stringify(books)); renderStats(); renderList(); }
    function exportData() { const blob = new Blob([JSON.stringify(books, null, 2)], { type: 'application/json' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'books.json'; a.click(); }
    function importData() { document.getElementById('fileInput').click(); }
    function loadFile(e) { const file = e.target.files[0]; const reader = new FileReader(); reader.onload = () => { books = JSON.parse(reader.result); localStorage.setItem('books', JSON.stringify(books)); renderStats(); populateFilters(); renderList(); }; reader.readAsText(file); }
  </script>
</body>
</html>